<?php
 /*
 * Arcanum Dev AwardPoints
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to arcanumdev@wafunotamago.com so we can send you a copy immediately.
 *
 * @category   Magento Sale Extension
 * @package    AwardPoints
 * @copyright  Copyright (c) 2012 Arcanum Dev. Y.K. (http://arcanumdev.wafunotamago.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<?php $points_currently_used = $this->getPointsCurrentlyUsed(); ?><?php $couponCode = Mage::getSingleton('checkout/cart')->getQuote()->getCouponCode(); ?><?php $pts = $this->getPointsOnOrder();?><?php if (!$this->getAutoUse()): ?><?php if (!$this->getCustomerId()):?><div class="discount"><h2><?php echo $this->__('Shopping Points'); ?></h2><div class="discount-form"><div style="padding-bottom:4px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/AwardPoints.png') ?>" alt="" />&nbsp;&nbsp;&nbsp;<?php echo $this->__("Total Cart Points");?>: <?php echo sprintf("%d", $pts);?></div><div style="padding-bottom:4px;"><em><strong><?php echo $this->__("You must Log In for use the Shopping points");?></strong></em></div></div></div><?php else:?><?php $point_details = $this->getPointsInfo();?><?php $baseCurrencyCode = Mage::app()->getStore()->getBaseCurrencyCode();?><?php $currentCurrencyCode = Mage::app()->getStore()->getCurrentCurrencyCode();?><?php $points = Mage::getStoreConfig('awardpoints/default/points_money');?><?php $points = $points*Mage::getStoreConfig('awardpoints/default/step_value');?><?php $point_value = Mage::helper('directory')->currencyConvert($points, $baseCurrencyCode, $currentCurrencyCode);?><?php if ($this->canUseCouponCode() && ($couponCode == "" || $couponCode == null) || !$this->canUseCouponCode()):?><div class="discount"><?php if (!$points_currently_used): ?><form action="<?php echo $this->getUrl('awardpoints/index/quotation/') ?>" method="post" name="discountFormPoints2"><h2><?php echo $this->__('Shopping Points'); ?></h2><div class="discount-form"><div style="padding-bottom:4px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/AwardPoints.png') ?>" alt="" />&nbsp;&nbsp;&nbsp;<?php echo $this->__("Total Cart Points");?>: <?php echo sprintf("%d", $pts);?></div><?php if ($point_details['points_money'] > $point_details['customer_points']):?><div style="padding-bottom:8px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/ClientPoints.png') ?>" alt="" />&nbsp;&nbsp;&nbsp;<?php echo $this->__('Your Total Points'); ?>: <?php echo sprintf('%d', $point_details['customer_points']); ?></div><div><?php echo $this->__('To get a discount you need at least %d points.', $point_details['step']); ?></div><?php else:?><div style="padding-bottom:8px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/ClientPoints.png') ?>" alt="" />&nbsp;&nbsp;&nbsp;<?php echo $this->__('Your Total Points'); ?>: <?php echo sprintf('%d', $point_details['customer_points']); ?></div><?php if ($point_details['step_apply']):?><div><?php echo $this->__('Please Select the quantity of points you want to use.') ?></div><select name="points_to_be_used" id="coupon_code_points_qty" class="input-text"><?php echo $this->pointsToAddOptions($point_details['customer_points'], $point_details['step']);?> </select>&nbsp;&nbsp;<span style="color:#C00; padding-bottom:3px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/Money.png') ?>" alt="" />&nbsp;&nbsp;<?php echo $this->__('%d points', Mage::getStoreConfig('awardpoints/default/step_value')); ?> = <?php echo sprintf(Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())->getSymbol() .$point_value); ?></span><?php else:?><?php if($point_details['full_use']):?><div><?php echo $this->__('Maximum amount of points allowed for this order') ?>: <?php echo sprintf('%d', $point_details['max_use']) ?></div><span style="color:#C00; padding-bottom:3px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/Money.png') ?>" alt="" />&nbsp;&nbsp;<?php echo $this->__('%d points', Mage::getStoreConfig('awardpoints/default/step_value')); ?> = <?php echo sprintf(Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())->getSymbol() .$point_value); ?></span><input type="hidden" value="<?php echo $point_details['max_use'];?>"  name="points_to_be_used" class="input-text" /><?php else:?><div><?php echo $this->__('Please input the quantity of points you want to use.') ?></div><input type="text" value="<?php if($point_details['full_use']):?><?php echo $point_details['max_use'];?><?php endif;?>"  name="points_to_be_used" class="input-text" maxlength="<?php echo strlen($point_details['customer_points']) ?>" style="width:100px"/>&nbsp;&nbsp;<span style="color:#C00; padding-bottom:3px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/Money.png') ?>" alt="" />&nbsp;&nbsp;<?php echo $this->__('%d points', Mage::getStoreConfig('awardpoints/default/step_value')); ?> = <?php echo sprintf(Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())->getSymbol() .$point_value); ?></span><?php endif;?><?php endif;?><div class="buttons-set"><button type="button" title="<?php echo $this->__('Apply Points') ?>" class="button" onclick="discountFormPoints2.submit(false)" value="<?php echo $this->__('Apply Points') ?>"><span><span><?php echo $this->__('Apply Points') ?></span></span></button></div><?php endif;?></div></form><?php else: ?><form action="<?php echo $this->getUrl('awardpoints/index/removequotation/') ?>" method="post" name="discountFormPoints2"><h2><?php echo $this->__('Shopping Points'); ?></h2><div class="discount-form"><div style="padding-bottom:4px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/AwardPoints.png') ?>" alt="" />&nbsp;&nbsp;&nbsp;<?php echo $this->__("Total Cart Points");?>: <?php echo sprintf("%d", $pts);?></div><?php $points_balabce = $this->getCustomerPoints()-$points_currently_used;?><div style="padding-bottom:8px;"><img src="<?php echo $this->getSkinUrl('images/AwardPoints/ClientPoints.png') ?>" alt="" />&nbsp;&nbsp;&nbsp;<?php echo $this->__('Your Points Balance'); ?>: <?php echo sprintf('%d', $points_balabce); ?></div><?php if($points_currently_used == $this->getCustomerPoints()):?><span><?php echo $this->__('You are currently using all your available points!'); ?>: <?php echo $this->__('%d', $points_currently_used); ?></span><?php else: ?><span><?php echo $this->__('You are currently using %d points', $points_currently_used); ?></span><?php endif;?><div class="buttons-set"><button type="button" title="<?php echo $this->__('Remove Points') ?>" class="button" onclick="discountFormPoints2.submit(false)" value="<?php echo $this->__('Remove Points') ?>"><span><span><?php echo $this->__('Remove Points') ?></span></span></button></div></div></form><?php endif;?></div><?php endif;?><?php endif;?><?php if ($this->canUseCouponCode() && ($points_currently_used < 1 || $points_currently_used == null) || !$this->canUseCouponCode()):?><?php echo $this->getChildHtml('coupon_original');?><?php endif;?><?php endif;?>