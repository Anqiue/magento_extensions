<?php
/**
 * @category   Php4u
 * @package    Php4u_BlastLuceneSearch
 * @author     Marcin Szterling <marcin@php4u.co.uk>
 * @copyright  Php4u Marcin Szterling (c) 2011
 * @license http://php4u.co.uk/licence/
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * Any form of ditribution, sell, transfer forbidden, reverse engineering forbidden - see licence above
 *
 * Code was obfusacted due to previous licence violations
 */
class Php4u_BlastLuceneSearch_Adminhtml_BlastlucenesearchController extends Mage_Adminhtml_Controller_Action { public function indexAction() { $this->loadLayout(); $this->_addContent($this->getLayout()->createBlock('blastlucenesearch/adminhtml_blastlucenesearch')); $this->renderLayout(); } public function markAction() { $_e4226677223500ac90c81099e89ee358 = (int)$this->getRequest()->getParam('storeId'); if ($_e4226677223500ac90c81099e89ee358 > 0) { $_244ec23b39956d32c3d2af074678942d = Mage::app()->getStore($_e4226677223500ac90c81099e89ee358); if (is_object($_244ec23b39956d32c3d2af074678942d)) { try { $_d7ad3d4148e30ab2d73fddf971ae48d8 = Mage::getSingleton('core/resource')->getConnection('blastlucenesearch_write'); $_c7fce958140990316af108f50a4b70ba = $_d7ad3d4148e30ab2d73fddf971ae48d8->fetchOne("SELECT entity_type_id FROM `".Mage::getSingleton('core/resource')->getTableName('eav_attribute')."` WHERE `attribute_code` LIKE 'lucene_indexed';"); $_8328c17e1130f1e8b656f216a70ef1b3 = "DELETE FROM `".Mage::getModel('blastlucenesearch/blastlucenesearch')->getProductTableIntName()."` WHERE entity_type_id = '{$_c7fce958140990316af108f50a4b70ba}' AND attribute_id = '".Mage::getResourceModel('eav/entity_attribute')->getIdByCode('catalog_product','lucene_indexed')."' AND store_id = '".$_e4226677223500ac90c81099e89ee358."';"; $_d7ad3d4148e30ab2d73fddf971ae48d8->query($_8328c17e1130f1e8b656f216a70ef1b3); } catch (Exception $_e72dd476fafe4c47751ae3198726443c) { Mage::getSingleton('core/session')->addWarning("Error while marking as unprocessed"); } Mage::getSingleton('core/session')->addSuccess("All products marked as require indexing for store ".$_244ec23b39956d32c3d2af074678942d->getName()); } else { Mage::getSingleton('core/session')->addWarning("Error while marking as unprocessed - store not found"); } } else { Mage::getSingleton('core/session')->addWarning("Error while marking as unprocessed - store not found"); } $this->_redirect('blastlucenesearch/adminhtml_blastlucenesearch/index'); } public function logAction() { if ($this->getRequest()->isAjax()) { $_89f336aed434bc12e2acba1a20dbdcf7 = Mage::getBaseDir('var').DS.'log'; $_e91ca6259064e28af085a80bc25d35e6 = $_89f336aed434bc12e2acba1a20dbdcf7 . DS .'blastlucenesearch.log'; if (is_file($_e91ca6259064e28af085a80bc25d35e6)) { $_3cec16c0c9fd531e88d460635f2bbc3f = implode("<br/>",$this->_read_file($_e91ca6259064e28af085a80bc25d35e6, 100)); echo $_3cec16c0c9fd531e88d460635f2bbc3f; } } die(); } public function statsAction() { $_7cae84d7bfa9e9dba1ec972a0999a9be = Mage::getBaseDir('var').DS.'indexer'; echo Mage::helper('php4u')->getAdminStatsTable($_7cae84d7bfa9e9dba1ec972a0999a9be); die(); } protected function _read_file($_b2d5413d547a7849ce936450397fb0ad, $_98118a72babb50ebda1bbb1e2c4a0fbe) { $_188d72476051d06969dd5b706dc08d64 = fopen($_b2d5413d547a7849ce936450397fb0ad, "r"); $_b818561a6c2d8d52665685f186a50283 = $_98118a72babb50ebda1bbb1e2c4a0fbe; $_4d96e815c067b0fd07784d023b201abc = -2; $_029822ea5e6e3e9ff9006dcb072dae41 = false; $_7cc2bbfb617b766800bdc8491d225ba5 = array(); while ($_b818561a6c2d8d52665685f186a50283 > 0) { $_ec754bc77f4e76e01b53de4674349afc = " "; while ($_ec754bc77f4e76e01b53de4674349afc != "\n") { if(fseek($_188d72476051d06969dd5b706dc08d64, $_4d96e815c067b0fd07784d023b201abc, SEEK_END) == -1) { $_029822ea5e6e3e9ff9006dcb072dae41 = true; break; } $_ec754bc77f4e76e01b53de4674349afc = fgetc($_188d72476051d06969dd5b706dc08d64); $_4d96e815c067b0fd07784d023b201abc --; } $_b818561a6c2d8d52665685f186a50283 --; if ($_029822ea5e6e3e9ff9006dcb072dae41) { rewind($_188d72476051d06969dd5b706dc08d64); } $_7cc2bbfb617b766800bdc8491d225ba5[$_98118a72babb50ebda1bbb1e2c4a0fbe-$_b818561a6c2d8d52665685f186a50283-1] = fgets($_188d72476051d06969dd5b706dc08d64); if ($_029822ea5e6e3e9ff9006dcb072dae41) break; } fclose ($_188d72476051d06969dd5b706dc08d64); return array_reverse($_7cc2bbfb617b766800bdc8491d225ba5); } }
?>

